<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asistente de Derivadas - Pensamiento Matemático III</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE'
                    }
                }
            }
        }
    </script>
    <style>
        .formula-card {
            transition: all 0.3s ease;
        }
        .formula-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(93, 92, 222, 0.2);
        }
        .active-tab {
            background: linear-gradient(135deg, #5D5CDE 0%, #7B7AFF 100%);
            color: white;
        }
        .math-formula {
            font-size: 1.1rem;
        }
    </style>
</head>
<body class="bg-white dark:bg-[#181818] text-gray-900 dark:text-gray-100 transition-colors">

    <!-- Header -->
    <header class="bg-gradient-to-r from-primary to-purple-600 text-white py-6 px-4 shadow-lg">
        <div class="max-w-6xl mx-auto">
            <h1 class="text-2xl md:text-3xl font-bold">📐 Asistente de Derivadas</h1>
            <p class="text-sm md:text-base mt-2 opacity-90">Pensamiento Matemático III - Guía Interactiva de Fórmulas</p>
        </div>
    </header>

    <div class="max-w-6xl mx-auto px-4 py-8">

        <!-- Navigation Tabs -->
        <div class="flex flex-wrap gap-2 mb-8">
            <button onclick="showSection('formulas')" id="tab-formulas" class="active-tab px-4 md:px-6 py-3 rounded-lg font-semibold transition-all text-base">
                📚 Fórmulas
            </button>
            <button onclick="showSection('selector')" id="tab-selector" class="bg-gray-200 dark:bg-gray-700 px-4 md:px-6 py-3 rounded-lg font-semibold transition-all hover:bg-gray-300 dark:hover:bg-gray-600 text-base">
                🎯 Selector
            </button>
            <button onclick="showSection('ejercicios')" id="tab-ejercicios" class="bg-gray-200 dark:bg-gray-700 px-4 md:px-6 py-3 rounded-lg font-semibold transition-all hover:bg-gray-300 dark:hover:bg-gray-600 text-base">
                📝 Ejercicios
            </button>
            <button onclick="showSection('quiz')" id="tab-quiz" class="bg-gray-200 dark:bg-gray-700 px-4 md:px-6 py-3 rounded-lg font-semibold transition-all hover:bg-gray-300 dark:hover:bg-gray-600 text-base">
                ✍️ Práctica
            </button>
        </div>

        <!-- Sección: Fórmulas -->
        <div id="section-formulas" class="space-y-6">
            <div class="bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-500 p-4 rounded">
                <p class="text-base"><strong>💡 Tip del Profesor:</strong> Identifica primero el tipo de función, luego aplica la fórmula correspondiente.</p>
            </div>

            <!-- Categorías de Fórmulas -->
            <div class="space-y-4">

                <!-- Reglas Básicas -->
                <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                    <h2 class="text-xl font-bold mb-4 text-primary">🔷 Reglas Básicas</h2>
                    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="formula-card bg-white dark:bg-gray-700 p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600">
                            <h3 class="font-semibold mb-2 text-gray-700 dark:text-gray-200">Constante</h3>
                            <div class="math-formula">$$\frac{d}{dx}(c) = 0$$</div>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Ejemplo: \(\frac{d}{dx}(5) = 0\)</p>
                        </div>
                        <div class="formula-card bg-white dark:bg-gray-700 p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600">
                            <h3 class="font-semibold mb-2 text-gray-700 dark:text-gray-200">Identidad</h3>
                            <div class="math-formula">$$\frac{d}{dx}(x) = 1$$</div>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">La derivada de x es 1</p>
                        </div>
                        <div class="formula-card bg-white dark:bg-gray-700 p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600">
                            <h3 class="font-semibold mb-2 text-gray-700 dark:text-gray-200">Regla de la Potencia</h3>
                            <div class="math-formula">$$\frac{d}{dx}(x^n) = nx^{n-1}$$</div>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Ejemplo: \(\frac{d}{dx}(x^3) = 3x^2\)</p>
                        </div>
                        <div class="formula-card bg-white dark:bg-gray-700 p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600">
                            <h3 class="font-semibold mb-2 text-gray-700 dark:text-gray-200">Múltiplo Constante</h3>
                            <div class="math-formula">$$\frac{d}{dx}(cu) = cu'$$</div>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Ejemplo: \(\frac{d}{dx}(5x^2) = 5(2x) = 10x\)</p>
                        </div>
                        <div class="formula-card bg-white dark:bg-gray-700 p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600">
                            <h3 class="font-semibold mb-2 text-gray-700 dark:text-gray-200">Función entre Constante</h3>
                            <div class="math-formula">$$\frac{d}{dx}\left(\frac{u}{c}\right) = \frac{u'}{c}$$</div>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Ejemplo: \(\frac{d}{dx}\left(\frac{x^2}{3}\right) = \frac{2x}{3}\)</p>
                        </div>
                        <div class="formula-card bg-white dark:bg-gray-700 p-4 rounded-lg border-2 border-gray-200 dark:border-gray-600">
                            <h3 class="font-semibold mb-2 text-gray-700 dark:text-gray-200">Constante entre Función</h3>
                            <div class="math-formula">$$\frac{d}{dx}\left(\frac{c}{u}\right) = -\frac{cu'}{u^2}$$</div>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Ejemplo: \(\frac{d}{dx}\left(\frac{5}{x}\right) = -\frac{5}{x^2}\)</p>
                        </div>
                    </div>
                </div>

                <!-- Funciones Trigonométricas -->
                <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                    <h2 class="text-xl font-bold mb-4 text-purple-600 dark:text-purple-400">🔷 Funciones Trigonométricas</h2>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="formula-card bg-white dark:bg-gray-700 p-4 rounded-lg border-2 border-purple-200 dark:border-purple-600">
                            <h3 class="font-semibold mb-2 text-gray-700 dark:text-gray-200">Seno</h3>
                            <div class="math-formula">$$\frac{d}{dx}(\sin x) = \cos x$$</div>
                        </div>
                        <div class="formula-card bg-white dark:bg-gray-700 p-4 rounded-lg border-2 border-purple-200 dark:border-purple-600">
                            <h3 class="font-semibold mb-2 text-gray-700 dark:text-gray-200">Coseno</h3>
                            <div class="math-formula">$$\frac{d}{dx}(\cos x) = -\sin x$$</div>
                        </div>
                        <div class="formula-card bg-white dark:bg-gray-700 p-4 rounded-lg border-2 border-purple-200 dark:border-purple-600">
                            <h3 class="font-semibold mb-2 text-gray-700 dark:text-gray-200">Tangente</h3>
                            <div class="math-formula">$$\frac{d}{dx}(\tan x) = \sec^2 x$$</div>
                        </div>
                        <div class="formula-card bg-white dark:bg-gray-700 p-4 rounded-lg border-2 border-purple-200 dark:border-purple-600">
                            <h3 class="font-semibold mb-2 text-gray-700 dark:text-gray-200">Cotangente</h3>
                            <div class="math-formula">$$\frac{d}{dx}(\cot x) = -\csc^2 x$$</div>
                        </div>
                        <div class="formula-card bg-white dark:bg-gray-700 p-4 rounded-lg border-2 border-purple-200 dark:border-purple-600">
                            <h3 class="font-semibold mb-2 text-gray-700 dark:text-gray-200">Secante</h3>
                            <div class="math-formula">$$\frac{d}{dx}(\sec x) = \sec x \tan x$$</div>
                        </div>
                        <div class="formula-card bg-white dark:bg-gray-700 p-4 rounded-lg border-2 border-purple-200 dark:border-purple-600">
                            <h3 class="font-semibold mb-2 text-gray-700 dark:text-gray-200">Cosecante</h3>
                            <div class="math-formula">$$\frac{d}{dx}(\csc x) = -\csc x \cot x$$</div>
                        </div>
                    </div>
                </div>

                <!-- Funciones Exponenciales y Logarítmicas -->
                <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                    <h2 class="text-xl font-bold mb-4 text-green-600 dark:text-green-400">🔷 Exponenciales y Logaritmos</h2>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="formula-card bg-white dark:bg-gray-700 p-4 rounded-lg border-2 border-green-200 dark:border-green-600">
                            <h3 class="font-semibold mb-2 text-gray-700 dark:text-gray-200">Exponencial natural</h3>
                            <div class="math-formula">$$\frac{d}{dx}(e^x) = e^x$$</div>
                        </div>
                        <div class="formula-card bg-white dark:bg-gray-700 p-4 rounded-lg border-2 border-green-200 dark:border-green-600">
                            <h3 class="font-semibold mb-2 text-gray-700 dark:text-gray-200">Exponencial base a</h3>
                            <div class="math-formula">$$\frac{d}{dx}(a^x) = a^x \ln a$$</div>
                        </div>
                        <div class="formula-card bg-white dark:bg-gray-700 p-4 rounded-lg border-2 border-green-200 dark:border-green-600">
                            <h3 class="font-semibold mb-2 text-gray-700 dark:text-gray-200">Logaritmo natural</h3>
                            <div class="math-formula">$$\frac{d}{dx}(\ln x) = \frac{1}{x}$$</div>
                        </div>
                        <div class="formula-card bg-white dark:bg-gray-700 p-4 rounded-lg border-2 border-green-200 dark:border-green-600">
                            <h3 class="font-semibold mb-2 text-gray-700 dark:text-gray-200">Logaritmo base a</h3>
                            <div class="math-formula">$$\frac{d}{dx}(\log_a x) = \frac{1}{x \ln a}$$</div>
                        </div>
                    </div>
                </div>

                <!-- Reglas de Operación -->
                <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                    <h2 class="text-xl font-bold mb-4 text-orange-600 dark:text-orange-400">🔷 Reglas de Operación</h2>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="formula-card bg-white dark:bg-gray-700 p-4 rounded-lg border-2 border-orange-200 dark:border-orange-600">
                            <h3 class="font-semibold mb-2 text-gray-700 dark:text-gray-200">Suma/Resta</h3>
                            <div class="math-formula">$$\frac{d}{dx}(u \pm v) = u' \pm v'$$</div>
                        </div>
                        <div class="formula-card bg-white dark:bg-gray-700 p-4 rounded-lg border-2 border-orange-200 dark:border-orange-600">
                            <h3 class="font-semibold mb-2 text-gray-700 dark:text-gray-200">Regla del Producto</h3>
                            <div class="math-formula">$$\frac{d}{dx}(u \cdot v) = u' \cdot v + u \cdot v'$$</div>
                        </div>
                        <div class="formula-card bg-white dark:bg-gray-700 p-4 rounded-lg border-2 border-orange-200 dark:border-orange-600">
                            <h3 class="font-semibold mb-2 text-gray-700 dark:text-gray-200">Regla del Cociente</h3>
                            <div class="math-formula">$$\frac{d}{dx}\left(\frac{u}{v}\right) = \frac{u' \cdot v - u \cdot v'}{v^2}$$</div>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Ejemplo: \(\frac{d}{dx}\left(\frac{x^2}{\sin x}\right)\)</p>
                        </div>
                        <div class="formula-card bg-white dark:bg-gray-700 p-4 rounded-lg border-2 border-orange-200 dark:border-orange-600">
                            <h3 class="font-semibold mb-2 text-gray-700 dark:text-gray-200">Potencia de una Función</h3>
                            <div class="math-formula">$$\frac{d}{dx}(u^n) = n \cdot u^{n-1} \cdot u'$$</div>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Ejemplo: \(\frac{d}{dx}((x^2+1)^3)\)</p>
                        </div>
                        <div class="formula-card bg-white dark:bg-gray-700 p-4 rounded-lg border-2 border-orange-200 dark:border-orange-600">
                            <h3 class="font-semibold mb-2 text-gray-700 dark:text-gray-200">Regla de la Cadena</h3>
                            <div class="math-formula">$$\frac{d}{dx}(u(v(x))) = u'(v(x)) \cdot v'(x)$$</div>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Ejemplo: \(\frac{d}{dx}(\sin(x^2))\)</p>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Sección: Selector Interactivo -->
        <div id="section-selector" class="hidden">
            <div class="bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-xl p-6 shadow-lg mb-6">
                <h2 class="text-2xl font-bold mb-4">🎯 Selector Inteligente de Fórmulas</h2>
                <p class="text-base mb-4">Ingresa tu función y te ayudaré a identificar qué fórmula usar:</p>

                <div class="space-y-4">
                    <div>
                        <label class="block font-semibold mb-2 text-base">Escribe tu función:</label>
                        <input type="text" id="functionInput" placeholder="Ejemplo: (x^2+1)^3, sin(x), x^2/sin(x), 5/x..."
                               class="w-full px-4 py-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:border-primary focus:outline-none">
                    </div>

                    <button onclick="analyzeFunction()"
                            class="w-full bg-gradient-to-r from-primary to-purple-600 text-white px-6 py-3 rounded-lg font-bold hover:shadow-lg transition-all text-base">
                        🔍 Analizar Función
                    </button>
                </div>
            </div>

            <div id="analysisResult" class="hidden">
                <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                    <h3 class="text-xl font-bold mb-4 text-primary">📊 Análisis de tu función:</h3>
                    <div id="resultContent" class="space-y-4"></div>
                </div>
            </div>
        </div>

        <!-- Sección: Ejercicios -->
        <div id="section-ejercicios" class="hidden">
            <div class="bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-xl p-6 shadow-lg mb-6">
                <h2 class="text-2xl font-bold mb-4">📝 Ejercicios de Práctica</h2>
                <p class="text-base mb-4">Resuelve los siguientes ejercicios identificando datos, fórmula y respuesta.</p>
            </div>

            <!-- Ejemplo Resuelto -->
            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg mb-6 border-2 border-primary">
                <h3 class="text-xl font-bold mb-4 text-primary">💡 Ejemplo: Cómo resolver un ejercicio</h3>

                <div class="mb-4">
                    <p class="font-semibold mb-2 text-base">Función:</p>
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg text-lg">
                        $$f(x) = (3x^2 - 2)^4$$
                    </div>
                </div>

                <div class="bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-500 p-4 rounded mb-4">
                    <p class="font-bold mb-2 text-base">📋 Paso 1: Identificación de datos</p>
                    <ul class="list-disc ml-6 space-y-1">
                        <li>Tipo de función: <strong>Potencia de una función (u<sup>n</sup>)</strong></li>
                        <li>Función interior: \(u = 3x^2 - 2\)</li>
                        <li>Exponente: \(n = 4\)</li>
                        <li>Derivada de u: \(u' = 6x\)</li>
                    </ul>
                </div>

                <div class="bg-orange-50 dark:bg-orange-900/20 border-l-4 border-orange-500 p-4 rounded mb-4">
                    <p class="font-bold mb-2 text-base">📐 Paso 2: Fórmula a utilizar</p>
                    <div class="text-lg ml-6">
                        $$\frac{d}{dx}(u^n) = n \cdot u^{n-1} \cdot u'$$
                    </div>
                </div>

                <div class="bg-green-50 dark:bg-green-900/20 border-l-4 border-green-500 p-4 rounded">
                    <p class="font-bold mb-2 text-base">✅ Paso 3: Respuesta</p>
                    <div class="ml-6">
                        <p class="mb-2">Aplicando la fórmula:</p>
                        <div class="text-lg">
                            $$f'(x) = 4 \cdot (3x^2 - 2)^{4-1} \cdot 6x$$
                            $$f'(x) = 4(3x^2 - 2)^3 \cdot 6x$$
                            $$f'(x) = 24x(3x^2 - 2)^3$$
                        </div>
                    </div>
                </div>
            </div>

            <!-- Lista de Ejercicios -->
            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                <h3 class="text-xl font-bold mb-4 text-primary">📚 Ejercicios para resolver</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Resuelve cada ejercicio siguiendo los 3 pasos del ejemplo anterior.</p>

                <div id="exercisesContainer" class="space-y-4">
                    <!-- Los ejercicios se generarán dinámicamente -->
                </div>
            </div>
        </div>

        <!-- Sección: Quiz de Práctica -->
        <div id="section-quiz" class="hidden">
            <div class="bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900/20 dark:to-blue-900/20 rounded-xl p-6 shadow-lg mb-6">
                <h2 class="text-2xl font-bold mb-4">✍️ Práctica Guiada</h2>
                <p class="text-base mb-4">Resuelve estos ejercicios para practicar la identificación de fórmulas:</p>
            </div>

            <div id="quizContainer" class="space-y-6">
                <!-- Los ejercicios se generarán dinámicamente -->
            </div>

            <div class="flex gap-4 mt-6">
                <button onclick="generateQuiz()"
                        class="flex-1 bg-gradient-to-r from-primary to-purple-600 text-white px-6 py-3 rounded-lg font-bold hover:shadow-lg transition-all text-base">
                    🔄 Nuevos Ejercicios
                </button>
                <button onclick="checkAnswers()"
                        class="flex-1 bg-green-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-green-700 transition-all text-base">
                    ✅ Verificar Respuestas
                </button>
            </div>

            <div id="quizResults" class="hidden mt-6 p-6 rounded-xl"></div>
        </div>

    </div>

    <script>
        // Dark mode support
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Navegación entre secciones
        function showSection(section) {
            // Ocultar todas las secciones
            document.querySelectorAll('[id^="section-"]').forEach(el => el.classList.add('hidden'));
            // Mostrar sección seleccionada
            document.getElementById(`section-${section}`).classList.remove('hidden');

            // Actualizar tabs
            document.querySelectorAll('[id^="tab-"]').forEach(el => {
                el.classList.remove('active-tab');
                el.classList.add('bg-gray-200', 'dark:bg-gray-700');
            });
            document.getElementById(`tab-${section}`).classList.add('active-tab');
            document.getElementById(`tab-${section}`).classList.remove('bg-gray-200', 'dark:bg-gray-700');
        }

        // Analizador de funciones
        function analyzeFunction() {
            const input = document.getElementById('functionInput').value.toLowerCase().trim();
            const resultDiv = document.getElementById('analysisResult');
            const contentDiv = document.getElementById('resultContent');

            if (!input) {
                showCustomAlert('Por favor ingresa una función');
                return;
            }

            let analysis = '';
            let formula = '';
            let example = '';

            // Análisis de patrones
            if (input === 'x') {
                formula = '\\(\\frac{d}{dx}(x) = 1\\)';
                example = 'La derivada de x es simplemente 1';
                analysis = '✅ <strong>Tipo:</strong> Identidad<br>✅ <strong>Fórmula:</strong> ' + formula + '<br>✅ <strong>Explicación:</strong> ' + example;
            }
            else if (!isNaN(input)) {
                formula = '\\(\\frac{d}{dx}(c) = 0\\)';
                example = 'Cualquier constante tiene derivada cero';
                analysis = '✅ <strong>Tipo:</strong> Constante<br>✅ <strong>Fórmula:</strong> ' + formula + '<br>✅ <strong>Explicación:</strong> ' + example;
            }
            else if (input.includes('x^') || input.includes('x²') || input.includes('x³')) {
                formula = '\\(\\frac{d}{dx}(x^n) = nx^{n-1}\\)';
                example = 'Para \\(x^3\\), la derivada sería \\(3x^2\\)';
                analysis = '✅ <strong>Tipo:</strong> Potencia<br>✅ <strong>Fórmula:</strong> ' + formula + '<br>✅ <strong>Ejemplo:</strong> ' + example;
            }
            else if (input.includes('sin') || input.includes('sen')) {
                formula = '\\(\\frac{d}{dx}(\\sin x) = \\cos x\\)';
                analysis = '✅ <strong>Tipo:</strong> Función Trigonométrica (Seno)<br>✅ <strong>Fórmula:</strong> ' + formula;
            }
            else if (input.includes('cos')) {
                formula = '\\(\\frac{d}{dx}(\\cos x) = -\\sin x\\)';
                analysis = '✅ <strong>Tipo:</strong> Función Trigonométrica (Coseno)<br>✅ <strong>Fórmula:</strong> ' + formula + '<br>⚠️ <strong>Nota:</strong> No olvides el signo negativo';
            }
            else if (input.includes('tan')) {
                formula = '\\(\\frac{d}{dx}(\\tan x) = \\sec^2 x\\)';
                analysis = '✅ <strong>Tipo:</strong> Función Trigonométrica (Tangente)<br>✅ <strong>Fórmula:</strong> ' + formula;
            }
            else if (input.includes('e^x') || input === 'e^x') {
                formula = '\\(\\frac{d}{dx}(e^x) = e^x\\)';
                example = 'La exponencial natural es su propia derivada';
                analysis = '✅ <strong>Tipo:</strong> Exponencial Natural<br>✅ <strong>Fórmula:</strong> ' + formula + '<br>✅ <strong>Nota especial:</strong> ' + example;
            }
            else if (input.includes('ln')) {
                formula = '\\(\\frac{d}{dx}(\\ln x) = \\frac{1}{x}\\)';
                analysis = '✅ <strong>Tipo:</strong> Logaritmo Natural<br>✅ <strong>Fórmula:</strong> ' + formula;
            }
            else if (input.includes('log')) {
                formula = '\\(\\frac{d}{dx}(\\log_a x) = \\frac{1}{x \\ln a}\\)';
                analysis = '✅ <strong>Tipo:</strong> Logaritmo (base a)<br>✅ <strong>Fórmula:</strong> ' + formula;
            }
            else if (input.match(/\([^)]+\)\^/) || input.match(/\([^)]+\)\*\*/) || input.includes('sen(') || input.includes('cos(')) {
                formula = '\\(\\frac{d}{dx}(u^n) = n \\cdot u^{n-1} \\cdot u\'\\)';
                example = 'Para \\((x^2+1)^3\\), identifica u = x²+1, n = 3, u\' = 2x';
                analysis = '✅ <strong>Tipo:</strong> Potencia de una Función<br>✅ <strong>Fórmula:</strong> ' + formula + '<br>✅ <strong>Explicación:</strong> ' + example + '<br>✅ <strong>Tip:</strong> Multiplica por el exponente, baja el exponente en 1, y multiplica por la derivada de la función interior (u\')';
            }
            else if (input.includes('*') || input.includes('·')) {
                formula = '\\(\\frac{d}{dx}(u \\cdot v) = u\' \\cdot v + u \\cdot v\'\\)';
                analysis = '✅ <strong>Tipo:</strong> Producto de funciones<br>✅ <strong>Fórmula (Regla del Producto):</strong> ' + formula + '<br>✅ <strong>Tip:</strong> Deriva la primera (u\') y multiplica por la segunda (v), más la primera (u) por la derivada de la segunda (v\')';
            }
            else if (input.includes('/')) {
                formula = '\\(\\frac{d}{dx}\\left(\\frac{u}{v}\\right) = \\frac{u\' \\cdot v - u \\cdot v\'}{v^2}\\)';
                analysis = '✅ <strong>Tipo:</strong> Cociente de funciones<br>✅ <strong>Fórmula (Regla del Cociente):</strong> ' + formula + '<br>✅ <strong>Tip:</strong> "Abajo (v) por arriba derivada (u\') menos arriba (u) por abajo derivada (v\'), todo sobre abajo al cuadrado (v²)"';
            }
            else {
                analysis = '🤔 <strong>No pude identificar la función exacta</strong><br><br>💡 <strong>Sugerencias:</strong><br>' +
                          '• Verifica la sintaxis (usa x^2 para potencias)<br>' +
                          '• Para funciones compuestas usa paréntesis: (x^2+1)^3<br>' +
                          '• Asegúrate de usar términos como: sin, cos, tan, e^x, ln, log<br>' +
                          '• Para cocientes usa /: x^2/sin(x)<br>' +
                          '• Revisa la sección de Fórmulas para más ejemplos';
            }

            contentDiv.innerHTML = '<div class="bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg border-l-4 border-primary">' + analysis + '</div>';
            resultDiv.classList.remove('hidden');

            // Re-render MathJax
            if (window.MathJax) {
                MathJax.typesetPromise([contentDiv]);
            }
        }

        // Base de datos de ejercicios
        const quizDatabase = [
            { function: '\\(f(x) = 7\\)', type: 'Constante', formula: '\\(\\frac{d}{dx}(c) = 0\\)' },
            { function: '\\(f(x) = x^5\\)', type: 'Potencia', formula: '\\(\\frac{d}{dx}(x^n) = nx^{n-1}\\)' },
            { function: '\\(f(x) = \\sin x\\)', type: 'Seno', formula: '\\(\\frac{d}{dx}(\\sin x) = \\cos x\\)' },
            { function: '\\(f(x) = \\cos x\\)', type: 'Coseno', formula: '\\(\\frac{d}{dx}(\\cos x) = -\\sin x\\)' },
            { function: '\\(f(x) = e^x\\)', type: 'Exponencial', formula: '\\(\\frac{d}{dx}(e^x) = e^x\\)' },
            { function: '\\(f(x) = \\ln x\\)', type: 'Logaritmo', formula: '\\(\\frac{d}{dx}(\\ln x) = \\frac{1}{x}\\)' },
            { function: '\\(f(x) = \\tan x\\)', type: 'Tangente', formula: '\\(\\frac{d}{dx}(\\tan x) = \\sec^2 x\\)' },
            { function: '\\(f(x) = 3x^2\\)', type: 'Potencia', formula: '\\(\\frac{d}{dx}(x^n) = nx^{n-1}\\)' },
            { function: '\\(f(x) = x^{-2}\\)', type: 'Potencia', formula: '\\(\\frac{d}{dx}(x^n) = nx^{n-1}\\)' },
            { function: '\\(f(x) = \\sqrt{x}\\)', type: 'Potencia', formula: '\\(\\frac{d}{dx}(x^n) = nx^{n-1}\\)' },
            { function: '\\(f(x) = 5x^3\\)', type: 'Múltiplo Constante', formula: '\\(\\frac{d}{dx}(cu) = cu\'\\)' },
            { function: '\\(f(x) = \\frac{x^2}{4}\\)', type: 'Función/Constante', formula: '\\(\\frac{d}{dx}\\left(\\frac{u}{c}\\right) = \\frac{u\'}{c}\\)' },
            { function: '\\(f(x) = \\frac{3}{x}\\)', type: 'Constante/Función', formula: '\\(\\frac{d}{dx}\\left(\\frac{c}{u}\\right) = -\\frac{cu\'}{u^2}\\)' },
            { function: '\\(f(x) = \\frac{5}{x^2}\\)', type: 'Constante/Función', formula: '\\(\\frac{d}{dx}\\left(\\frac{c}{u}\\right) = -\\frac{cu\'}{u^2}\\)' },
            { function: '\\(f(x) = (x^2 + 1)^3\\)', type: 'Potencia de Función', formula: '\\(\\frac{d}{dx}(u^n) = n \\cdot u^{n-1} \\cdot u\'\\)' },
            { function: '\\(f(x) = (3x - 2)^5\\)', type: 'Potencia de Función', formula: '\\(\\frac{d}{dx}(u^n) = n \\cdot u^{n-1} \\cdot u\'\\)' },
            { function: '\\(f(x) = (\\sin x)^2\\)', type: 'Potencia de Función', formula: '\\(\\frac{d}{dx}(u^n) = n \\cdot u^{n-1} \\cdot u\'\\)' },
            { function: '\\(f(x) = \\frac{x^2}{\\sin x}\\)', type: 'Cociente', formula: '\\(\\frac{d}{dx}\\left(\\frac{u}{v}\\right) = \\frac{u\' \\cdot v - u \\cdot v\'}{v^2}\\)' }
        ];

        const formulaOptions = [
            '\\(\\frac{d}{dx}(c) = 0\\)',
            '\\(\\frac{d}{dx}(x^n) = nx^{n-1}\\)',
            '\\(\\frac{d}{dx}(\\sin x) = \\cos x\\)',
            '\\(\\frac{d}{dx}(\\cos x) = -\\sin x\\)',
            '\\(\\frac{d}{dx}(\\tan x) = \\sec^2 x\\)',
            '\\(\\frac{d}{dx}(e^x) = e^x\\)',
            '\\(\\frac{d}{dx}(\\ln x) = \\frac{1}{x}\\)',
            '\\(\\frac{d}{dx}(u \\cdot v) = u\' \\cdot v + u \\cdot v\'\\)',
            '\\(\\frac{d}{dx}\\left(\\frac{u}{v}\\right) = \\frac{u\' \\cdot v - u \\cdot v\'}{v^2}\\)',
            '\\(\\frac{d}{dx}(cu) = cu\'\\)',
            '\\(\\frac{d}{dx}\\left(\\frac{u}{c}\\right) = \\frac{u\'}{c}\\)',
            '\\(\\frac{d}{dx}\\left(\\frac{c}{u}\\right) = -\\frac{cu\'}{u^2}\\)',
            '\\(\\frac{d}{dx}(u^n) = n \\cdot u^{n-1} \\cdot u\'\\)'
        ];

        let currentQuiz = [];

        function generateQuiz() {
            // Seleccionar 5 ejercicios aleatorios
            const shuffled = [...quizDatabase].sort(() => 0.5 - Math.random());
            currentQuiz = shuffled.slice(0, 5);

            const container = document.getElementById('quizContainer');
            container.innerHTML = '';

            currentQuiz.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg';

                let optionsHTML = '';
                formulaOptions.forEach((option, optIndex) => {
                    optionsHTML += `
                        <label class="flex items-start space-x-3 p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer transition-colors">
                            <input type="radio" name="q${index}" value="${optIndex}" class="mt-1">
                            <span class="text-base">${option}</span>
                        </label>
                    `;
                });

                questionDiv.innerHTML = `
                    <h3 class="text-lg font-bold mb-4 text-primary">Ejercicio ${index + 1}</h3>
                    <div class="mb-4 text-lg bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        ${question.function}
                    </div>
                    <p class="font-semibold mb-3 text-base">Selecciona la fórmula correcta:</p>
                    <div class="space-y-2">
                        ${optionsHTML}
                    </div>
                `;

                container.appendChild(questionDiv);
            });

            document.getElementById('quizResults').classList.add('hidden');

            // Re-render MathJax
            if (window.MathJax) {
                MathJax.typesetPromise([container]);
            }
        }

        function checkAnswers() {
            let correct = 0;
            let results = '';

            currentQuiz.forEach((question, index) => {
                const selected = document.querySelector(`input[name="q${index}"]:checked`);
                const correctIndex = formulaOptions.indexOf(question.formula);

                if (selected && parseInt(selected.value) === correctIndex) {
                    correct++;
                    results += `<div class="bg-green-50 dark:bg-green-900/30 p-4 rounded-lg border-l-4 border-green-500 mb-3">
                        <p class="font-bold text-green-700 dark:text-green-400">✅ Ejercicio ${index + 1}: Correcto</p>
                        <p class="text-sm mt-1">${question.function} → ${question.formula}</p>
                    </div>`;
                } else {
                    results += `<div class="bg-red-50 dark:bg-red-900/30 p-4 rounded-lg border-l-4 border-red-500 mb-3">
                        <p class="font-bold text-red-700 dark:text-red-400">❌ Ejercicio ${index + 1}: Incorrecto</p>
                        <p class="text-sm mt-1"><strong>Fórmula correcta:</strong> ${question.formula}</p>
                    </div>`;
                }
            });

            const percentage = (correct / currentQuiz.length) * 100;
            let message = '';
            let bgClass = '';

            if (percentage >= 80) {
                message = '🎉 ¡Excelente! Dominas las fórmulas de derivadas.';
                bgClass = 'bg-green-100 dark:bg-green-900/30 border-green-500';
            } else if (percentage >= 60) {
                message = '👍 Buen trabajo, pero puedes mejorar. Revisa las fórmulas.';
                bgClass = 'bg-yellow-100 dark:bg-yellow-900/30 border-yellow-500';
            } else {
                message = '📚 Sigue practicando. Revisa la sección de Fórmulas.';
                bgClass = 'bg-red-100 dark:bg-red-900/30 border-red-500';
            }

            const resultsDiv = document.getElementById('quizResults');
            resultsDiv.className = `p-6 rounded-xl ${bgClass} border-l-4`;
            resultsDiv.innerHTML = `
                <h3 class="text-2xl font-bold mb-4">Resultados: ${correct}/${currentQuiz.length} (${percentage.toFixed(0)}%)</h3>
                <p class="text-lg mb-4">${message}</p>
                ${results}
            `;
            resultsDiv.classList.remove('hidden');

            // Re-render MathJax
            if (window.MathJax) {
                MathJax.typesetPromise([resultsDiv]);
            }
        }

        // Custom alert function
        function showCustomAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4 text-base">${message}</p>
                    <div class="flex justify-end">
                        <button class="px-4 py-2 bg-primary text-white hover:bg-purple-700 rounded" onclick="this.closest('.fixed').remove()">Aceptar</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Lista de 20 ejercicios combinados
        const exercisesDatabase = [
            '\\(f(x) = 12\\)',
            '\\(f(x) = x\\)',
            '\\(f(x) = x^6\\)',
            '\\(f(x) = 4x^5\\)',
            '\\(f(x) = \\frac{x^4}{3}\\)',
            '\\(f(x) = \\frac{8}{x^3}\\)',
            '\\(f(x) = \\frac{2x^3 - 5}{x+1}\\)',
            '\\(f(x) = (x^2 + 4)^3\\)',
            '\\(f(x) = 3x^4 - 2x^2 + 9\\)',
            '\\(f(x) = x^3(2x - 1)\\)',
            '\\(f(x) = -7\\)',
            '\\(f(x) = x^{-2}\\)',
            '\\(f(x) = 6x^2\\)',
            '\\(f(x) = \\frac{x^3}{5}\\)',
            '\\(f(x) = \\frac{3}{x}\\)',
            '\\(f(x) = \\frac{x^2 - 1}{x + 2}\\)',
            '\\(f(x) = (5x - 3)^4\\)',
            '\\(f(x) = x^5 + 3x^3 - 7x\\)',
            '\\(f(x) = (x^2 + 1)(x - 4)\\)',
            '\\(f(x) = (x^4 - 2x)^2\\)'
        ];

        function displayExercises() {
            const container = document.getElementById('exercisesContainer');
            container.innerHTML = '';

            exercisesDatabase.forEach((exercise, index) => {
                const exerciseDiv = document.createElement('div');
                exerciseDiv.className = 'border-b border-gray-200 dark:border-gray-700 pb-3 mb-3 last:border-b-0';

                exerciseDiv.innerHTML = `
                    <div class="flex items-start gap-3">
                        <span class="font-bold text-primary min-w-[30px]">${index + 1}.</span>
                        <div class="flex-1 bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
                            ${exercise}
                        </div>
                    </div>
                `;

                container.appendChild(exerciseDiv);
            });

            // Re-render MathJax
            if (window.MathJax) {
                MathJax.typesetPromise([container]);
            }
        }

        // Inicializar ejercicios
        displayExercises();

        // Generar quiz inicial
        generateQuiz();

        // Permitir Enter en el input
        document.getElementById('functionInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                analyzeFunction();
            }
        });
    </script>
</body>
</html>